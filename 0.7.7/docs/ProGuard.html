<html>
 <head> 
  <title>ProGuard</title> 
 </head> 
 <body> 
  <div id="wikipage"> 
   <table> 
    <tbody>
     <tr> 
      <td style="vertical-align:top; padding-left:5px"> 
       <div id="wikiheader"> 
        <span style="font-size:120%;font-weight:bold">ProGuard</span> &nbsp; 
        <div>  
        </div> 
       </div> 
       <div id="wikicontent"> 
        <div class="vt" id="wikimaincol"> 
         <h1><a name="Introduction"></a>Introduction<a href="#Introduction" class="section_anchor"></a></h1>
         <p>The sbt build uses <a href="http://proguard.sourceforge.net/index.html" rel="nofollow">ProGuard</a> to create the self-contained launcher jar. The size of the sbt launcher jar went up after migrating it from 2.7.7 to 2.8.0.RC3. The size increased from about 0.9MB to 1.2MB. There were several reasons: </p>
         <ul>
          <li>The general increase in generated bytecode size in 2.8 due to moving the Scala signatures to annotations </li>
          <li>Array construction in 2.8 requires manifests and thus brings in new classes from <tt>scala.reflect</tt> </li>
          <li>StringBuilder now uses RichInt, which brings in new classes from <tt>scala.math</tt> </li>
          <li>Some reorganization in the Scala library generally made the old ProGuard configuration for sbt less optimal. </li>
         </ul>
         <p></p>
         <p>Previously, the sbt build only made use of the minifying feature of ProGuard. The obfuscation and optimization phases were disabled with these options: </p>
         <pre class="prettyprint">  -dontoptimize
  -dontobfuscate</pre>
         <p>To eliminate the 300kB increase between 2.7 and 2.8, the sbt build now enables these phases, as explained below. For full details on ProGuard configuration, see the <a href="http://proguard.sourceforge.net/manual/sections.html" rel="nofollow">ProGuard manual</a>. </p>
         <h1><a name="Obfuscation"></a>Obfuscation<a href="#Obfuscation" class="section_anchor"></a></h1>
         <p>The obfuscation phase shortens names and can substantially decrease the size of a jar. However, stack traces become less usable and so sbt did not use it. The obfuscation phase is also responsible for stripping attributes/annotations, though. This aspect is especially useful for Scala. Scala signatures are stored in the class file as annotations. It is possible to configure the ProGuard obfuscation phase to preserve names but still remove attributes. The ProGuard configuration lines for this look like: </p>
         <pre class="prettyprint"> -keep,allowoptimization,allowshrinking class * { *; }&quot;,
 -keepattributes SourceFile,LineNumberTable</pre>
         <p>This disables renaming and keeps the source name and lines numbers for meaningful stack traces. This prevents renaming but still strips attributes/annotations. If you need to preserve certain annotations or other attributes, you can append them to <tt>-keepattributes</tt>. See the <a href="http://proguard.sourceforge.net/manual/usage.html#obfuscationoptions" rel="nofollow">ProGuard documentation</a> for details. </p>
         <p>Enabling this phase reduced the size of the launcher jar by about 200kB. </p>
         <h1><a name="Optimization"></a>Optimization<a href="#Optimization" class="section_anchor"></a></h1>
         <p>The optimization phase is also useful, although each optimization pass increases the time it takes for ProGuard to run. Enabling optimization reduced the size of the launcher another 100kB. It is especially good for reducing the size of the extra classes brought in by RichInt and references from the <tt>scala</tt> package object. For example, the <tt>$scope</tt> val would normally pull in XML classes and <tt>val</tt>s that exist only for source compatibility pull in their respective classes. The ProGuard optimization options used by sbt are: </p>
         <pre class="prettyprint"> -optimizationpasses 2
 -optimizations !code/allocation/variable</pre>
         <p>More passes increase processing time, but you might get a larger size decrease or a runtime performance increase. Three passes did not reduce the size any more than two did for the sbt launcher. The second line disables an optimization that caused a runtime error (with ProGuard 4.4). </p> 
        </div> 
       </div> </td>
     </tr>
     <tr> 
     </tr>
    </tbody>
   </table> 
  </div> 
  <script type="text/javascript" src="http://www.gstatic.com/codesite/ph/5509366563142316864/js/dit_scripts.js"></script>   
 </body>
</html>