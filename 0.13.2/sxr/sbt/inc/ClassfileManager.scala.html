<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <title>sbt/inc/ClassfileManager.scala</title>
        <script type="text/javascript" src="../../jquery-all.js"></script>
        <script type="text/javascript" src="../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="keyword">package</span> sbt.inc

	<span class="keyword">import</span> sbt.IO
	<span class="keyword">import</span> java.io.File
	<span class="keyword">import</span> collection.mutable

<span class="comment">/** During an incremental compilation run, a ClassfileManager deletes class files and is notified of generated class files.
* A ClassfileManager can be used only once.*/</span>
<span class="keyword">trait</span> <a title="trait ClassfileManager extends AnyRef" id="sbt.inc;ClassfileManager">ClassfileManager</a>
<span class="delimiter">{</span>
	<span class="comment">/** Called once per compilation step with the class files to delete prior to that step's compilation.
	* The files in `classes` must not exist if this method returns normally.
	* Any empty ancestor directories of deleted files must not exist either.*/</span>
	<span class="keyword">def</span> <a title="(classes: Iterable[java.io.File])Unit" id="sbt.inc;ClassfileManager.delete">delete</a><span class="delimiter">(</span><a title="Iterable[java.io.File]" id="sbt.inc;ClassfileManager.delete.classes">classes</a>: <span title="Iterable[java.io.File]">Iterable</span><span class="delimiter">[</span>File<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="Unit">Unit</span>

	<span class="comment">/** Called once per compilation step with the class files generated during that step.*/</span>	
	<span class="keyword">def</span> <a title="(classes: Iterable[java.io.File])Unit" id="sbt.inc;ClassfileManager.generated">generated</a><span class="delimiter">(</span><a title="Iterable[java.io.File]" id="sbt.inc;ClassfileManager.generated.classes">classes</a>: <span title="Iterable[java.io.File]">Iterable</span><span class="delimiter">[</span>File<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="Unit">Unit</span>

	<span class="comment">/** Called once at the end of the whole compilation run, with `success` indicating whether compilation succeeded (true) or not (false).*/</span>
	<span class="keyword">def</span> <a title="(success: Boolean)Unit" id="sbt.inc;ClassfileManager.complete">complete</a><span class="delimiter">(</span><a title="Boolean" id="sbt.inc;ClassfileManager.complete.success">success</a>: <span title="Boolean">Boolean</span><span class="delimiter">)</span>: <span title="Unit">Unit</span>
<span class="delimiter">}</span>

<span title="AnyRef" class="keyword">object</span> <a title="sbt.inc.ClassfileManager.type" id="sbt.inc.ClassfileManager">ClassfileManager</a>
<a href="#sbt.inc.ClassfileManager" title="sbt.inc.ClassfileManager.type" class="delimiter">{</a>
	<span class="comment">/** Constructs a minimal ClassfileManager implementation that immediately deletes class files when requested. */</span>
	<span class="keyword">val</span> <a title="() =&gt; sbt.inc.ClassfileManager" id="sbt.inc.ClassfileManager.deleteImmediately">deleteImmediately</a>: <span class="delimiter">(</span><span class="delimiter">)</span> =&gt; ClassfileManager = <span class="delimiter">(</span><span class="delimiter">)</span> =&gt; <a href="#sbt.inc.ClassfileManager.deleteImmediately.$anonfun;$anon" title="sbt.inc.ClassfileManager" class="keyword">new</a> <a title="anonymous class $anon extends AnyRef with sbt.inc.ClassfileManager" id="sbt.inc.ClassfileManager.deleteImmediately.$anonfun;$anon">ClassfileManager</a>
	<span class="delimiter">{</span>
		<span class="keyword">def</span> <a title="(classes: Iterable[java.io.File])Unit" id="sbt.inc.ClassfileManager.deleteImmediately.$anonfun;$anon.delete">delete</a><span class="delimiter">(</span><a title="Iterable[java.io.File]" id="sbt.inc.ClassfileManager.deleteImmediately.$anonfun;$anon.delete.classes">classes</a>: <span title="Iterable[java.io.File]">Iterable</span><span class="delimiter">[</span>File<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <a href="../IO.scala.html#sbt.IO" title="sbt.IO.type">IO</a>.<a href="../IO.scala.html#sbt.IO.deleteFilesEmptyDirs" title="(files: Iterable[java.io.File])Unit">deleteFilesEmptyDirs</a><span class="delimiter">(</span><a href="#sbt.inc.ClassfileManager.deleteImmediately.$anonfun;$anon.delete.classes" title="Iterable[java.io.File]">classes</a><span class="delimiter">)</span>
		<span class="keyword">def</span> <a title="(classes: Iterable[java.io.File])Unit" id="sbt.inc.ClassfileManager.deleteImmediately.$anonfun;$anon.generated">generated</a><span class="delimiter">(</span><a title="Iterable[java.io.File]" id="sbt.inc.ClassfileManager.deleteImmediately.$anonfun;$anon.generated.classes">classes</a>: <span title="Iterable[java.io.File]">Iterable</span><span class="delimiter">[</span>File<span class="delimiter">]</span><span class="delimiter">)</span> <span title="Unit" class="delimiter">{</span><span class="delimiter">}</span>
		<span class="keyword">def</span> <a title="(success: Boolean)Unit" id="sbt.inc.ClassfileManager.deleteImmediately.$anonfun;$anon.complete">complete</a><span class="delimiter">(</span><a title="Boolean" id="sbt.inc.ClassfileManager.deleteImmediately.$anonfun;$anon.complete.success">success</a>: <span title="Boolean">Boolean</span><span class="delimiter">)</span> <span title="Unit" class="delimiter">{</span><span class="delimiter">}</span>
	<span class="delimiter">}</span>
	<span class="comment">/** When compilation fails, this ClassfileManager restores class files to the way they were before compilation.*/</span>
	<span class="keyword">def</span> <a title="(tempDir0: java.io.File)() =&gt; sbt.inc.ClassfileManager" id="sbt.inc.ClassfileManager.transactional">transactional</a><span class="delimiter">(</span><a title="java.io.File" id="sbt.inc.ClassfileManager.transactional.tempDir0">tempDir0</a>: <span title="java.io.File">File</span><span class="delimiter">)</span>: <span class="delimiter">(</span><span class="delimiter">)</span> =&gt; ClassfileManager = <span class="delimiter">(</span><span class="delimiter">)</span> =&gt; <a href="#sbt.inc.ClassfileManager.transactional.$anonfun;$anon" title="sbt.inc.ClassfileManager{}" class="keyword">new</a> <a title="anonymous class $anon extends AnyRef with sbt.inc.ClassfileManager" id="sbt.inc.ClassfileManager.transactional.$anonfun;$anon">ClassfileManager</a>
	<span class="delimiter">{</span>
		<span class="keyword">val</span> <a title="java.io.File" id="sbt.inc.ClassfileManager.transactional.$anonfun;$anon.tempDir">tempDir</a> = <a href="#sbt.inc.ClassfileManager.transactional.tempDir0" title="java.io.File">tempDir0</a>.<span title="()java.io.File">getCanonicalFile</span>
		<a href="../IO.scala.html#sbt.IO" title="sbt.IO.type">IO</a>.<a href="../IO.scala.html#sbt.IO.delete(e3f9ce1f75)" title="(file: java.io.File)Unit">delete</a><span class="delimiter">(</span><a href="#sbt.inc.ClassfileManager.transactional.$anonfun;$anon.tempDir" title="=&gt; java.io.File">tempDir</a><span class="delimiter">)</span>
		<a href="../IO.scala.html#sbt.IO" title="sbt.IO.type">IO</a>.<a href="../IO.scala.html#sbt.IO.createDirectory" title="(dir: java.io.File)Unit">createDirectory</a><span class="delimiter">(</span><a href="#sbt.inc.ClassfileManager.transactional.$anonfun;$anon.tempDir" title="=&gt; java.io.File">tempDir</a><span class="delimiter">)</span>

		<span class="keyword">private</span><span class="delimiter">[</span><span class="keyword">this</span><span class="delimiter">]</span> <span class="keyword">val</span> <a title="scala.collection.mutable.HashSet[java.io.File]" id="sbt.inc.ClassfileManager.transactional.$anonfun;$anon.generatedClasses">generatedClasses</a> = <span title="()scala.collection.mutable.HashSet[java.io.File]" class="keyword">new</span> mutable.<span title="scala.collection.mutable.HashSet[java.io.File]">HashSet</span><span class="delimiter">[</span>File<span class="delimiter">]</span>
		<span class="keyword">private</span><span class="delimiter">[</span><span class="keyword">this</span><span class="delimiter">]</span> <span class="keyword">val</span> <a title="scala.collection.mutable.HashMap[java.io.File,java.io.File]" id="sbt.inc.ClassfileManager.transactional.$anonfun;$anon.movedClasses">movedClasses</a> = <span title="()scala.collection.mutable.HashMap[java.io.File,java.io.File]" class="keyword">new</span> mutable.<span title="scala.collection.mutable.HashMap[java.io.File,java.io.File]">HashMap</span><span class="delimiter">[</span>File, File<span class="delimiter">]</span>
	
		<span class="keyword">def</span> <a title="(classes: Iterable[java.io.File])Unit" id="sbt.inc.ClassfileManager.transactional.$anonfun;$anon.delete">delete</a><span class="delimiter">(</span><a title="Iterable[java.io.File]" id="sbt.inc.ClassfileManager.transactional.$anonfun;$anon.delete.classes">classes</a>: <span title="Iterable[java.io.File]">Iterable</span><span class="delimiter">[</span>File<span class="delimiter">]</span><span class="delimiter">)</span>
		<span class="delimiter">{</span>
			<span class="keyword">for</span><span class="delimiter">(</span><a title="java.io.File" id="sbt.inc.ClassfileManager.transactional.$anonfun;$anon.delete.$anonfun.c">c</a> &lt;- <a href="#sbt.inc.ClassfileManager.transactional.$anonfun;$anon.delete.classes" title="(f: java.io.File =&gt; Any)Unit">classes</a><span class="delimiter">)</span> <span title="Any" class="keyword">if</span><span class="delimiter">(</span><a href="#sbt.inc.ClassfileManager.transactional.$anonfun;$anon.delete.$anonfun.c" title="java.io.File">c</a>.<span title="()Boolean">exists</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <span title="=&gt; Boolean">!</span><a href="#sbt.inc.ClassfileManager.transactional.$anonfun;$anon.movedClasses" title="scala.collection.mutable.HashMap[java.io.File,java.io.File]">movedClasses</a>.<span title="(key: java.io.File)Boolean">contains</span><span class="delimiter">(</span><a href="#sbt.inc.ClassfileManager.transactional.$anonfun;$anon.delete.$anonfun.c" title="java.io.File">c</a><span class="delimiter">)</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <span title="=&gt; Boolean">!</span><a href="#sbt.inc.ClassfileManager.transactional.$anonfun;$anon.generatedClasses" title="(elem: java.io.File)Boolean">generatedClasses</a><span class="delimiter">(</span><a href="#sbt.inc.ClassfileManager.transactional.$anonfun;$anon.delete.$anonfun.c" title="java.io.File">c</a><span class="delimiter">)</span><span class="delimiter">)</span>
				<a href="#sbt.inc.ClassfileManager.transactional.$anonfun;$anon.movedClasses" title="scala.collection.mutable.HashMap[java.io.File,java.io.File]">movedClasses</a>.<span title="(key: java.io.File, value: java.io.File)Option[java.io.File]">put</span><span class="delimiter">(</span><a href="#sbt.inc.ClassfileManager.transactional.$anonfun;$anon.delete.$anonfun.c" title="java.io.File">c</a>, <a href="#sbt.inc.ClassfileManager.transactional.$anonfun;$anon.move" title="(c: java.io.File)java.io.File">move</a><span class="delimiter">(</span><a href="#sbt.inc.ClassfileManager.transactional.$anonfun;$anon.delete.$anonfun.c" title="java.io.File">c</a><span class="delimiter">)</span><span class="delimiter">)</span>
			<a href="../IO.scala.html#sbt.IO" title="sbt.IO.type">IO</a>.<a href="../IO.scala.html#sbt.IO.deleteFilesEmptyDirs" title="(files: Iterable[java.io.File])Unit">deleteFilesEmptyDirs</a><span class="delimiter">(</span><a href="#sbt.inc.ClassfileManager.transactional.$anonfun;$anon.delete.classes" title="Iterable[java.io.File]">classes</a><span class="delimiter">)</span>
		<span class="delimiter">}</span>
		<span class="keyword">def</span> <a title="(classes: Iterable[java.io.File])Unit" id="sbt.inc.ClassfileManager.transactional.$anonfun;$anon.generated">generated</a><span class="delimiter">(</span><a title="Iterable[java.io.File]" id="sbt.inc.ClassfileManager.transactional.$anonfun;$anon.generated.classes">classes</a>: <span title="Iterable[java.io.File]">Iterable</span><span class="delimiter">[</span>File<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <a href="#sbt.inc.ClassfileManager.transactional.$anonfun;$anon.generatedClasses" title="scala.collection.mutable.HashSet[java.io.File]">generatedClasses</a> <span title="(xs: scala.collection.TraversableOnce[java.io.File])this.generatedClasses.type">++=</span> <a href="#sbt.inc.ClassfileManager.transactional.$anonfun;$anon.generated.classes" title="Iterable[java.io.File]">classes</a>
		<span class="keyword">def</span> <a title="(success: Boolean)Unit" id="sbt.inc.ClassfileManager.transactional.$anonfun;$anon.complete">complete</a><span class="delimiter">(</span><a title="Boolean" id="sbt.inc.ClassfileManager.transactional.$anonfun;$anon.complete.success">success</a>: <span title="Boolean">Boolean</span><span class="delimiter">)</span>
		<span class="delimiter">{</span>
			<span title="Unit" class="keyword">if</span><span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#sbt.inc.ClassfileManager.transactional.$anonfun;$anon.complete.success" title="Boolean">success</a><span class="delimiter">)</span> <span class="delimiter">{</span>
				<a href="../IO.scala.html#sbt.IO" title="sbt.IO.type">IO</a>.<a href="../IO.scala.html#sbt.IO.deleteFilesEmptyDirs" title="(files: Iterable[java.io.File])Unit">deleteFilesEmptyDirs</a><span class="delimiter">(</span><a href="#sbt.inc.ClassfileManager.transactional.$anonfun;$anon.generatedClasses" title="scala.collection.mutable.HashSet[java.io.File]">generatedClasses</a><span class="delimiter">)</span>
				<span class="keyword">for</span><span class="delimiter">(</span> <span class="delimiter">(</span><a title="java.io.File" id="sbt.inc.ClassfileManager.transactional.$anonfun;$anon.complete.$anonfun.orig">orig</a>, <a title="java.io.File" id="sbt.inc.ClassfileManager.transactional.$anonfun;$anon.complete.$anonfun.tmp">tmp</a><span class="delimiter">)</span> &lt;- <a href="#sbt.inc.ClassfileManager.transactional.$anonfun;$anon.movedClasses" title="(f: ((java.io.File, java.io.File)) =&gt; Unit)Unit">movedClasses</a> <span class="delimiter">)</span> <a href="../IO.scala.html#sbt.IO" title="sbt.IO.type">IO</a>.<a href="../IO.scala.html#sbt.IO.move(6b7aaadca5)" title="(a: java.io.File, b: java.io.File)Unit">move</a><span class="delimiter">(</span><a href="#sbt.inc.ClassfileManager.transactional.$anonfun;$anon.complete.$anonfun.tmp" title="java.io.File">tmp</a>, <a href="#sbt.inc.ClassfileManager.transactional.$anonfun;$anon.complete.$anonfun.orig" title="java.io.File">orig</a><span class="delimiter">)</span>
			<span class="delimiter">}</span>
			<a href="../IO.scala.html#sbt.IO" title="sbt.IO.type">IO</a>.<a href="../IO.scala.html#sbt.IO.delete(e3f9ce1f75)" title="(file: java.io.File)Unit">delete</a><span class="delimiter">(</span><a href="#sbt.inc.ClassfileManager.transactional.$anonfun;$anon.tempDir" title="=&gt; java.io.File">tempDir</a><span class="delimiter">)</span>
		<span class="delimiter">}</span>

		<span class="keyword">def</span> <a title="(c: java.io.File)java.io.File" id="sbt.inc.ClassfileManager.transactional.$anonfun;$anon.move">move</a><span class="delimiter">(</span><a title="java.io.File" id="sbt.inc.ClassfileManager.transactional.$anonfun;$anon.move.c">c</a>: <span title="java.io.File">File</span><span class="delimiter">)</span>: <span title="java.io.File">File</span> =
		<span class="delimiter">{</span>
			<span class="keyword">val</span> <a title="java.io.File" id="sbt.inc.ClassfileManager.transactional.$anonfun;$anon.move.target">target</a> = <span title="java.io.File.type">File</span>.<span title="(x$1: String, x$2: String, x$3: java.io.File)java.io.File">createTempFile</span><span class="delimiter">(</span><span title="String(&quot;sbt&quot;)" class="string">&quot;sbt&quot;</span>, <span title="String(&quot;.class&quot;)" class="string">&quot;.class&quot;</span>, <a href="#sbt.inc.ClassfileManager.transactional.$anonfun;$anon.tempDir" title="=&gt; java.io.File">tempDir</a><span class="delimiter">)</span>
			<a href="../IO.scala.html#sbt.IO" title="sbt.IO.type">IO</a>.<a href="../IO.scala.html#sbt.IO.move(6b7aaadca5)" title="(a: java.io.File, b: java.io.File)Unit">move</a><span class="delimiter">(</span><a href="#sbt.inc.ClassfileManager.transactional.$anonfun;$anon.move.c" title="java.io.File">c</a>, <a href="#sbt.inc.ClassfileManager.transactional.$anonfun;$anon.move.target" title="java.io.File">target</a><span class="delimiter">)</span>
			<a href="#sbt.inc.ClassfileManager.transactional.$anonfun;$anon.move.target" title="java.io.File">target</a>
		<span class="delimiter">}</span>
	<span class="delimiter">}</span>
<span class="delimiter">}</span>
        </pre>
    </body>
</html>
